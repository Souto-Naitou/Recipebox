<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>レシピ管理システム</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="logo">
                        <i class="fas fa-utensils"></i>
                        レシピ管理システム
                    </h1>
                    <p class="subtitle">レシピと材料の統合管理ツール</p>
                </div>
                <div class="header-right">
                    <button class="theme-toggle" id="themeToggle" title="テーマを切り替える">
                        <i class="fas fa-sun" id="themeIcon"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- ウェルカムセクション -->
            <section class="welcome-section" id="welcomeSection">
                <div class="welcome-card">
                    <div class="welcome-icon">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <h2>レシピ管理システムへようこそ！</h2>
                    <p class="welcome-description">
                        複雑なレシピと材料の依存関係を効率的に管理できるツールです。<br>
                        100個以上のレシピにも対応し、材料の自動計算と在庫管理が可能です。
                    </p>
                    <div class="welcome-actions">
                        <button class="welcome-btn primary" onclick="showRecipeManager()">
                            <i class="fas fa-plus"></i> 最初のレシピを作成
                        </button>
                        <button class="welcome-btn secondary" id="welcomeImportBtn">
                            <i class="fas fa-upload"></i> レシピをインポート
                        </button>
                    </div>
                </div>
            </section>



            <!-- Recipe Management -->
            <section class="recipe-management-section">
                <div class="section-header">
                    <h2><i class="fas fa-database"></i> レシピ管理</h2>
                    <div class="recipe-search-bar">
                        <input type="text" id="quickSearch" placeholder="レシピを検索..." onkeyup="quickSearchRecipes()">
                        <button class="search-btn" onclick="showRecipeList()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <div class="management-buttons">
                        <button class="management-btn primary" onclick="showRecipeManager()">
                            <i class="fas fa-plus"></i> レシピ追加
                        </button>
                        <button class="management-btn secondary" onclick="showRecipeList()">
                            <i class="fas fa-list"></i> レシピ一覧
                        </button>
                        <button class="management-btn secondary" id="exportBtn">
                            <i class="fas fa-download"></i> エクスポート
                        </button>
                        <button class="management-btn secondary" id="importBtn">
                            <i class="fas fa-upload"></i> インポート
                        </button>
                        <button class="management-btn tertiary" onclick="showBackupList()">
                            <i class="fas fa-history"></i> バックアップ
                        </button>
                        <button class="management-btn danger" onclick="clearAllLocalStorage()">
                            <i class="fas fa-trash-alt"></i> 全データ削除
                        </button>
                    </div>
                </div>
                <div class="recipe-card recipe-management-card">
                    <div class="recipe-selector-section">
                        <h3><i class="fas fa-utensils"></i> レシピ選択</h3>
                        <div class="recipe-selector">
                            <label for="selectedRecipe">計算対象のレシピ:</label>
                            <select id="selectedRecipe" onchange="onRecipeSelected()">
                                <option value="">レシピを選択してください</option>
                            </select>
                        </div>
                        <div class="recipe-tree-container" id="recipeTreeContainer" style="display: none;">
                            <h3><i class="fas fa-sitemap"></i> レシピ構成ツリー</h3>
                            <div class="recipe-tree" id="recipeTree">
                                <!-- ツリー構造がここに表示されます -->
                            </div>
                        </div>
                    </div>
                    <div class="recipe-stats">
                        <div class="stat-item">
                            <span class="stat-label">登録レシピ数</span>
                            <span class="stat-value" id="recipeCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">基本材料数</span>
                            <span class="stat-value" id="basicItemCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">作成可能数</span>
                            <span class="stat-value" id="maxCraftable">0</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Material Calculator -->
            <section class="calculator-section">
                <div class="section-header">
                    <h2><i class="fas fa-calculator"></i> 材料計算機</h2>
                </div>
                <div class="calculator-card">
                    <div class="calculator-input">
                        <label for="quantity">作りたい個数:</label>
                        <input type="number" id="quantity" value="100" min="1" max="1000">
                        <button onclick="calculateMaterials()">計算</button>
                    </div>
                    <div class="calculation-result" id="calculationResult">
                        <!-- 計算結果がここに表示されます -->
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 レシピ管理システム. All rights reserved.</p>
        </footer>
    </div>

    <!-- Recipe Manager Modal -->
    <div id="recipeManagerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">レシピ追加</h3>
                <span class="close" onclick="closeRecipeManager()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="recipeForm">
                    <div class="form-group">
                        <label for="recipeName">レシピ名:</label>
                        <input type="text" id="recipeName" required>
                    </div>
                    <div class="form-group">
                        <label for="baseQuantity">基本作成数:</label>
                        <input type="number" id="baseQuantity" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label for="recipeIcon">アイコン:</label>
                        <select id="recipeIcon">
                            <option value="fa-utensils">デフォルト</option>
                            <option value="fa-cheese">チーズ</option>
                            <option value="fa-bread-slice">パン</option>
                            <option value="fa-egg">卵</option>
                            <option value="fa-glass-water">液体</option>
                            <option value="fa-ice-cream">クリーム</option>
                            <option value="fa-butter">バター</option>
                            <option value="fa-cube">固体</option>
                            <option value="fa-flask">薬品</option>
                            <option value="fa-fire">調理</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>材料:</label>
                        <div id="ingredientsList">
                            <!-- 材料リストがここに表示されます -->
                        </div>
                        <button type="button" onclick="addIngredient()" class="add-ingredient-btn">
                            <i class="fas fa-plus"></i> 材料追加
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="closeRecipeManager()" class="cancel-btn">キャンセル</button>
                <button type="button" onclick="saveRecipe()" class="save-btn">保存</button>
            </div>
        </div>
    </div>

    <!-- Recipe List Modal -->
    <div id="recipeListModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>レシピ一覧</h3>
                <span class="close" onclick="closeRecipeList()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="recipe-filter">
                    <input type="text" id="recipeSearch" placeholder="レシピを検索..." onkeyup="filterRecipes()">
                    <select id="recipeTypeFilter" onchange="filterRecipes()">
                        <option value="all">全て</option>
                        <option value="basic">基本材料</option>
                        <option value="recipe">レシピ</option>
                    </select>
                </div>
                <div id="recipeListContent">
                    <!-- レシピリストがここに表示されます -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Ingredient Modal -->
    <div id="addIngredientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>新しい材料を追加</h3>
                <span class="close" onclick="closeAddIngredientModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addIngredientForm">
                    <div class="form-group">
                        <label for="newIngredientName">材料名:</label>
                        <input type="text" id="newIngredientName" required placeholder="例: トマト, 小麦粉, 砂糖">
                    </div>
                    <div class="form-group">
                        <label for="newIngredientIcon">アイコン:</label>
                        <select id="newIngredientIcon">
                            <option value="fa-utensils">🍴 基本</option>
                            <option value="fa-egg">🥚 卵</option>
                            <option value="fa-glass-water">🥛 液体</option>
                            <option value="fa-bread-slice">🍞 パン/生地</option>
                            <option value="fa-cheese">🧀 チーズ</option>
                            <option value="fa-butter">🧈 バター</option>
                            <option value="fa-ice-cream">🍦 クリーム</option>
                            <option value="fa-salt-shaker">🧂 調味料</option>
                            <option value="fa-cube">⬜ 粉/固形</option>
                            <option value="fa-fish">🐟 魚</option>
                            <option value="fa-drumstick-bite">🍗 肉</option>
                            <option value="fa-carrot">🥕 野菜</option>
                            <option value="fa-apple-alt">🍎 果物</option>
                        </select>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="closeAddIngredientModal()" class="cancel-btn">キャンセル</button>
                <button type="button" onclick="saveNewIngredient()" class="save-btn">追加</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileImport(event)">

    <!-- JavaScript files -->
    <script src="js/theme-manager.js"></script>
    <script src="js/custom-dropdown.js"></script>
    <script src="js/dropdown-integration.js"></script>
    <script src="js/database.js"></script>
    <script src="js/recipe-manager.js"></script>
    <script src="js/ui-manager.js"></script>
    <script src="js/inventory-manager.js"></script>
    <script src="js/file-manager.js"></script>
    <script src="script.js"></script>
</body>
</html>